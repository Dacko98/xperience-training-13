@using System.Threading;
@using XperienceAdapter.Extensions;
@using MedioClinic.ViewComponents
@model MedioClinic.Models.ViewComponents.Navigation.TopNavigationContentsModel

@{
    var culture = Thread.CurrentThread.CurrentUICulture.ToSiteCulture();
    List<Business.Models.NavigationItem>? navigationItems = default;

    if (culture != null)
    {
        navigationItems = Model?.Navigation?[culture]?.ChildItems;
    }
}

<ul id="@Model?.MainId" class="@Model?.ListClass">
    @{
        var triggerViewName = $"{Navigation.PartialViewPath}/_DropdownTrigger";
    }

    @if (navigationItems?.Any() == true)
    {
        foreach (var item in navigationItems)
        {
            if (Model?.DisplaySecondLevel == true && item.ChildItems?.Any() == true)
            {
                var childItemDtos = item.ChildItems.Select(item => (item.RelativeUrl, item.Name));
                <partial name="@triggerViewName" model="@(Guid.NewGuid().ToString(), item.Name, childItemDtos)" />
            }
            else
            {
                <partial name="_ListItemWithLink" model="@(item.RelativeUrl, item.Name, string.Empty)" />
            }
        }
    }

    @if (Model?.CultureSwitchId != null)
    {
        <vc:language culture-switch-id="@Model?.CultureSwitchId" />
    }

    @{
        var identityNavigation = new List<(string, string)>();
    }

    @if (Context.User.Identity.IsAuthenticated)
    {
        identityNavigation.Add((Url.Action("Index", "Profile", new { area = "Identity", culture = Thread.CurrentThread.CurrentUICulture.Name }).ToLowerInvariant(), "Profile"));
        identityNavigation.Add((Url.Action("Signout", "Account", new { area = "Identity", culture = Thread.CurrentThread.CurrentUICulture.Name }).ToLowerInvariant(), "Sign out"));
    }
    else
    {
        identityNavigation.Add((Url.Action("Signin", "Account", new { area = "Identity", culture = Thread.CurrentThread.CurrentUICulture }).ToLowerInvariant(), "Sign in"));
    }

    <partial name="@triggerViewName" model="@(Guid.NewGuid().ToString(), "Identity", (IEnumerable<(string, string)>)identityNavigation)" />
</ul>
